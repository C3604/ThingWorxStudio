var TW = TW || {};
TW.SDK = TW.SDK || {};
TW.SDK.Types = TW.SDK.Types || {};

(function () {
    TW.SDK.Types.VariantPrimitive = {
        decode: function(data) {
            TW.SDK.HelperFunctions.validateParameter(data, 'data', ArrayBuffer);
            var view = new DataView(data);

            var type = view.getInt8(0);
            var value = TW.SDK.Primitives.fromCode(type).decode(data.slice(1));

            return {
                length: value.length + 1,
                content: {
                    baseType: TW.SDK.BaseTypes.fromCode(type),
                    value: value.content
                }
            };
        },

        encode: function(content) {
            TW.SDK.HelperFunctions.validateParameter(content, 'content', 'object');

            var buffers = [];

            var type = TW.SDK.BaseTypes[content.baseType];
            buffers.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(type));
            buffers.push(TW.SDK.Primitives.fromCode(type).encode(content.value));

            _.flatten(buffers);

            return TW.SDK.HelperFunctions.combineArrayBuffers(buffers);
        },

        getDefaultValue: function() {
            return {
                baseType: "STRING",
                value: ""
            };
        }
    };
})();
