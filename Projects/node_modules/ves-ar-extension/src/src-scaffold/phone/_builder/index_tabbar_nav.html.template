<!doctype html>
<html ng-controller="AppCtrl as app">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name = "format-detection" content = "telephone=no">
  <link rel="stylesheet" href="css/<%= theme =%>-theme.css?v<%= uuid =%>">

  <!-- Extension Stylesheets -->
  {% for s in extensions.stylesheets %}<link rel="stylesheet" href="extensions/<%= s.extension =%>/<%= s.script =%>">
  {% endfor %}

  <link rel="stylesheet" href="css/app.css?v<%= uuid =%>">
  <link rel="stylesheet" href="app/shared/styles/app.css?v<%= uuid =%>">
</head>
<body ng-cloak>
  <ng-include src="'app/shared/components/Device.html'"></ng-include>
  <ng-include src="'app/shared/components/Data.html'"></ng-include>
  <ion-side-menus ng-controller="AppsMenuCtrl" class="seethrough">
    <!-- Center content -->
    <ion-side-menu-content>
      <ion-nav-bar class="bar-positive">
        <ion-nav-back-button>
          Back
        </ion-nav-back-button>
      </ion-nav-bar>
      <ion-nav-view></ion-nav-view>
    </ion-side-menu-content>

  </ion-side-menus>

<script src="lib/cdn/ionic.bundle.min.js"></script>
<script src="lib/cdn/ng-cordova.min.js"></script>
<script src="lib/cdn/ngStorage.min.js"></script>
<script src="lib/uuid.js"></script>
<script src="lib/twx-connector.js"></script>
<script src="lib/twx-client-core-all.js"></script>
<script src="lib/cdn/ng-google-chart.min.js"></script>
<script src="lib/bower-ng-twx-uicomponents/charts.js"></script>
<script src='lib/cdn/lodash.min.js'></script>
<script src="lib/http-auth-interceptor.js"></script>
<script src="app/app.js?v<%= uuid =%>"></script>
<script src="app-runtime.js"></script>

<!--<script src="appCtrl.js"></script>
<script src="appsMenuCtrl.js"></script>-->

<!-- TML Related -->
<script src="tml/vuforia-angular.js"></script>
<script src="tml/simpleAnimation.js"></script>
<script src="tml/cssparser.js"></script>
<script src="tml/loader/animation.js"></script>
<script src="tml/loader/sequence.js"></script>
<script src="tml/loader/ptcadapter/ARScene.js"></script>
<script src="tml/loader/ptcadapter/ARPlayerAnimationAdapter.js"></script>
<script src="tml/pako/pako.min.js"></script>
<script src="lib/cdn/three.min.js"></script>
<script src="tml/util/Vector3.js"></script>
<script src="tml/util/Quaternion.js"></script>
<script src="tml/util/Euler.js"></script>
<script src="tml/util/Matrix4.js"></script>
<script src="tml/tween/Tween.js"></script>
<script src="lib/cdn/d3.min.js"></script>

<!-- Extension Libraries -->
{% for lib in extensions.runtimeLibraries %}<script src="extensions/<%=  lib.substring(lib.lastIndexOf(PATH_SEP) + 1) =%>"></script>
{% endfor %}

<!-- Extension Angular Modules -->
{% for module in extensions.angular_modules %}<script src="extensions/<%= module.extension =%>/<%= module.script =%>"></script>
{% endfor %}

<script type="text/javascript">
var setUpAngularModuleAndBootstrap = function() {
  angular.module('app')
    .config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {

      $stateProvider

        // setup an abstract state for the tabs directive
          .state('tab', {
          url: "/tab",
          abstract: true,
          templateUrl: "tabs.html"
        })

        // Each tab has its own nav history stack:

        {% for v1 in views %}

        {% if v1.showInMainMenu %}

        .state('tab.<%= v1.fileName =%>', {
          url: '/<%= v1.fileName =%>?entityName&thing&template&vumark',
          views: {
            '<%= v1.fileName =%>': {
              templateUrl: 'app/components/<%= v1.fileName =%>.html',
              cache: false,
              controller: 'BaseCtrl'
            }
          },
          data: { targetPrefix: '<%= v1.fileName =%>-' }
        })

        {% for v2 in views %}

        {% if !v2.showInMainMenu %}
        // subview
        .state('tab.<%= v1.fileName =%>-<%= v2.fileName =%>', {
          url: '/<%= v1.fileName =%>-<%= v2.fileName =%>',
          views: {
            '<%= v1.fileName =%>': {
              templateUrl: 'app/components/<%= v2.fileName =%>.html',
              cache: false,
              controller: 'BaseCtrl'
            }
          },
          data: { targetPrefix: '<%= v1.fileName =%>-' }
        })
        {% endif %}

        {% endfor %}

        {% endif %}

        {% endfor %}

        // if none of the above states are matched, use this as the fallback
        $urlRouterProvider.otherwise('/tab/Home');

    }]);

    angular.bootstrap(document, ['app']);
};

if( window.chrome )  {
    setUpAngularModuleAndBootstrap();
} else {
    window.ionic.Platform.ready(function() {
        setUpAngularModuleAndBootstrap();
    });

}
</script>
</body>
</html>
