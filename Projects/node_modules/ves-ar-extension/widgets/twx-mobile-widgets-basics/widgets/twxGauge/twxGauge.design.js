/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
function twxGauge() {
  function guid() {
    function _p8(s) {
      var p = (Math.random().toString(16) + "000000000").substr(2, 8);
      return s ? "-" + p.substr(0, 4) + "-" + p.substr(4, 4) : p;
    }

    return _p8() + _p8(true) + _p8(true) + _p8();
  }

  return {
    elementTag: 'twx-gauge',

    label: 'ves-ar-extension:Gauge',

    category: 'ionic-2D',

    properties: addStateFormattingProperties([
      {
        name: 'class',
        label: 'ves-ar-extension:Class',
        datatype: 'string',
        isBindingTarget: true
      },
      {
        name: 'min',
        label: 'ves-ar-extension:Minimum Value',
        datatype: 'string',
        default: '0',
        isBindingTarget: true
      },
      {
        name: 'max',
        label: 'ves-ar-extension:Maximum Value',
        datatype: 'string',
        default: '100',
        isBindingTarget: true
      },
      {
        name: 'value',
        label: 'ves-ar-extension:Value',
        datatype: 'string',
        default: '0',
        isBindingTarget: true,
        defaultDependentField: true
      },
      {
        name: 'humanFriendlyDecimal',
        label: 'ves-ar-extension:Decimal Scale',
        datatype: 'number',
        default: 0,
        isBindingTarget: false
      },
      {
        name: 'title',
        label: 'ves-ar-extension:Gauge Title',
        datatype: 'string',
        default: ''
      },
      {
        name: 'width',
        label: 'ves-ar-extension:Width',
        datatype: 'string',
        default: '100%'
      },
      {
        name: 'height',
        label: 'ves-ar-extension:Height',
        datatype: 'string',
        default: '100%'
      },
      {
        name: 'visible',
        label: 'ves-ar-extension:Visible',
        datatype: 'boolean',
        default: true,
        isBindingTarget: true
      }
    ]),

    services: [
      {
        name: 'updateChart',
        label: 'ves-ar-extension:Update Chart'
      }
    ],

    designTemplate: function () {
      var text = window.i18next.t('ves-ar-extension:2D Gauge');
      return '<div class="gauge chart {{me.class}}">' + text + '</div>';
    },

    runtimeTemplate: function (props) {
      if (!props.humanFriendlyDecimal) {
        props.humanFriendlyDecimal = 0;
      }
      else if (props.humanFriendlyDecimal > 0) {
        props.humanFriendly = true;
      }
      var tmpl = '<div class="gage-container" style="width: '+ props.width +'; height: '+ props.height +';">' + 
                    '<just-gage ng-show="app.fn.isTrue(me.visible)" id="gauge-' + guid()+ '" class="{{me.class}}" ' +
                    ' max="me.max" min="me.min" value="{{me.value}}" title="'+ props.title +'" width="'+ props.width +'" height="'+ props.height +'" options="{humanFriendlyDecimal: '+props.humanFriendlyDecimal+', humanFriendly: '+props.humanFriendly+'}">' +
                    '</just-gage>' + 
                  '</div>';
      return tmpl;
    }
  };
}

twxAppBuilder.widget('twxGauge', twxGauge);