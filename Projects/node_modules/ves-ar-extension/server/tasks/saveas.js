/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
'use strict';

var path = require('path');
var fs = require('fs-extra');

function onsaveas(params) {
  return new Promise(function(resolve, reject) {
    try {
      const logger = params.logger;
      logger.info('Duplicating ves-ar-extension app:', params.path);
      var pathDir = params.path;
      var destDir = params.destination;
      var newConfigFile =  path.join(destDir, 'appConfig.json');
      fs.copySync(path.join(pathDir, 'src'), path.join(destDir, 'src'));
      fs.copySync(path.join(pathDir, 'appConfig.json'), newConfigFile);
      var newSettings = fs.readJsonSync(newConfigFile);
      newSettings.name = params.newName;
      newSettings.fileName = params.destination;
      fs.writeJsonSync(newConfigFile, newSettings, {spaces: 2});
      resolve();
    }
    catch (e) {
      reject(e);
      console.error("Error Duplicating", e);
    }
  });
}

module.exports = {
  onsaveas: onsaveas
};
