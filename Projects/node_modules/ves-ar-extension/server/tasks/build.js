/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
'use strict';

const Q = require('q');

function onbuild(params) {
    const logger = params.logger;
    logger.info('Building ves-ar-extension app:', params.name);
    var pathDir = params.path;
    var deferred = Q.defer();
    try {
        var gulpShared = require(pathDir + '/gulp-shared.js');
        var scaffoldDir = gulpShared.getScaffoldDir(params);
        gulpShared.clean(null, pathDir);
        logger.debug('pathDir', pathDir);
        logger.debug('scaffoldDir', scaffoldDir);
        logger.debug('copySrc');
        var cpRes = gulpShared.copySrc(null, pathDir, scaffoldDir, params);
        cpRes.then(function() {
            logger.debug('buildApp');
            gulpShared.buildApp(null, pathDir, scaffoldDir, params);
            deferred.resolve();
        }, function(error) {
            deferred.reject(error);
        });
    }
    catch (e) {
        deferred.reject(e);
        console.error("Error building", e);
    }
    return deferred.promise;
}

module.exports = {
    onbuild: onbuild
};
