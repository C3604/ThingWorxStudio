/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
(function(twxAppBuilder){

  function twxPopup(){
    return {
      elementTag: 'twx-popup',

      label: 'ves-basic-web-widgets-extension:Popup',

      category: 'basic-html',

      isContainer: true,

      isVisibleInPalette: true,

      properties: [
        { 
            name: 'class',
            label: 'ves-basic-web-widgets-extension:Class',
            datatype: 'string',
            //default: '',
            isBindingTarget: true
        },
        {
          name: 'width',
          label: 'ves-basic-web-widgets-extension:Width (px, %, vh, em)',
          datatype: 'string',
          default: '80%'
        },
        {
          name: 'height',
          label: 'ves-basic-web-widgets-extension:Height (px, %, vh, em)',
          datatype: 'string',
          default: 'auto'
        },
        {
            name: 'padding',
            label: 'ves-basic-web-widgets-extension:Padding',
            datatype: 'string',
            default: '5px'
        },
        {
          name: 'type',
          label: 'ves-basic-web-widgets-extension: Type',
          datatype: 'string',
          editor: 'select',
          options: [
                { label: 'ves-basic-web-widgets-extension:Floating Popup', value: 'floatingpopup' },
                { label: 'ves-basic-web-widgets-extension:Modal', value: 'modal' }
            ],
          default: 'floatingpopup'
        },
        {
          name: 'centered',
          label: 'ves-basic-web-widgets-extension: Centered',
          datatype: 'boolean',
          default: true
        },
        {
          name: 'top',
          label: 'ves-basic-web-widgets-extension: Top (px, %, em, vh)',
          datatype: 'string',
          default: '',
          isVisible: function(props){
            return (props.centered === false);
          }
        },
        {
          name: 'bottom',
          label: 'ves-basic-web-widgets-extension: Bottom (px, %, em, vh)',
          datatype: 'string',
          default: '',
          isVisible: function(props){
            return (props.centered === false);
          }
        },
        {
          name: 'left',
          label: 'ves-basic-web-widgets-extension: Left (px, %, em, vh)',
          datatype: 'string',
          default: '',
          isVisible: function(props){
            return (props.centered === false);
          }
        },
        {
          name: 'right',
          label: 'ves-basic-web-widgets-extension: Right (px, %, em, vh)',
          datatype: 'string',
          default: '',
          isVisible: function(props){
            return (props.centered === false);
          }
        },
        {
          name: 'visible',
          label: 'ves-basic-web-widgets-extension:Visible',
          datatype: 'boolean',
          default: false,
          isBindingTarget: true
        },
        {
          name: 'isVisibleAtDesigntime',
          label: 'ves-basic-web-widgets-extension:Is Visible at Designtime',
          datatype: 'boolean',
          default: true,
          isVisible: false
        }
      ],
      services: [
          {
              name: 'hidepopup',
              label: 'ves-basic-web-widgets-extension:Hide Popup'
          },
          {
              name: 'showpopup',
              label: 'ves-basic-web-widgets-extension:Show Popup'
          }
      ],

      cssPosition: function(me) {
        if(me.centered === true) {
          return 'top: 50%; left: 50%; transform: translate(-50%, -50%);'
        } else {
          return 'top:'+ me.top +';' + 
                  'bottom:'+ me.bottom +';' + 
                  'left:'+ me.left +';' + 
                  'right:'+ me.right +';'
        }
      },

      designTemplate: function(props){
        return '<div class="popup-overlay" ng-show="me.type === \'modal\' && me.isVisibleAtDesigntime"></div><twx-container-content class="twx-popup {{me.class}}" style="{{ctrl.widgetDef.cssPosition(me)}} padding: {{me.padding}}; width: {{me.width}}; height: {{me.height}};" ng-show="me.isVisibleAtDesigntime"></twx-container-content>';
      },

      runtimeTemplate: function(props){
        var height = '';
        if (props.height) {
          height = 'height: ' + props.height + ';'
        }
        var width = '';
        if (props.width) {
          width = 'width: ' + props.width + ';'
        }
        var padding = '';
        if (props.padding) {
          padding = 'padding:' + props.padding + ';';
        }
        var position = '';
        if (props.centered === true){
          position = 'top: 50%; left: 50%; transform: translate(-50%, -50%);';
        } else {
          position = 'top:'+ props.top +';' + 
                      'bottom:'+ props.bottom +';' + 
                      'left:'+ props.left +';' + 
                      'right:'+ props.right +';'
        }
        var modalBackdrop = '';
        if (props.type === 'modal') {
          var modalBackdrop = '<div class="popup-overlay"></div>';  
        }

        var tmpl = '<div class="twx-popup-container {{(me.visible ? \'\' : \'hidden\')}}" twx-popup-service>' + modalBackdrop + '<div class="twx-popup {{me.class}}" style="' + height + width + padding + position + '"><twx-container-content></twx-container-content</div></div>';
        return tmpl;
      }
    }
  }

  twxAppBuilder.widget('twxPopup', twxPopup);

})(twxAppBuilder);