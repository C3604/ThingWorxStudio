/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
function twxVideo() {
    return {
        elementTag: 'twx-video',

        label: 'ves-basic-web-widgets-extension:Video',

        category: 'basic-html',

        properties: [
            {
                name: 'videosrc',
                label: 'ves-basic-web-widgets-extension:Video Source',
                datatype: 'resource_url',
                allowedPatterns: ['.mp4','.webm'],
                default: '',
                isBindingTarget: true
            },
            {
                name: 'class',
                label: 'ves-basic-web-widgets-extension:Class',
                datatype: 'string',
                //default: '',
                isBindingTarget: true
            },
            {
                name: 'width',
                label: 'ves-basic-web-widgets-extension:Width',
                datatype: 'string',
                default: '',
                isBindingTarget: true
            },
            {
                name: 'height',
                label: 'ves-basic-web-widgets-extension:Height',
                datatype: 'string',
                default: '',
                isBindingTarget: true
            },
            {
                name: 'showcontrols',
                label: 'ves-basic-web-widgets-extension:Show Controls',
                datatype: 'boolean',
                alwaysWriteAttribute: true,
                default: true,
                isBindingTarget: true
            },
            {
                name: 'preload',
                label: 'ves-basic-web-widgets-extension:Preload',
                datatype: 'string',
                default: 'none',
                editor: 'select',
                options: [
                    {label: 'ves-basic-web-widgets-extension:Content', value: 'auto'},
                    {label: 'ves-basic-web-widgets-extension:Metadata Only', value: 'metadata'},
                    {label: 'ves-basic-web-widgets-extension:None', value: 'none'}
                ]
            },
            {
                name: 'isPlaying',
                label: 'ves-basic-web-widgets-extension:Playing',
                datatype: 'boolean',
                default: false,
                isBindingSource: true,
                isBindingTarget: false,
                showInput: false
            },
            {
                name: 'visible',
                label: 'ves-basic-web-widgets-extension:Visible',
                datatype: 'boolean',
                default: true,
                isBindingTarget: true
            }
        ],

        services: [
            {
                name: 'play',
                label: 'ves-basic-web-widgets-extension:Play'
            },
            {
                name: 'pause',
                label: 'ves-basic-web-widgets-extension:Pause'
            }
        ],

        events: [
            {
                name: 'playStarted',
                label: 'ves-basic-web-widgets-extension:Play Started'
            },
            {
                name: 'playPaused',
                label: 'ves-basic-web-widgets-extension:Play Paused'
            },
            {
                name: 'playEnded',
                label: 'ves-basic-web-widgets-extension:Play Ended'
            }
        ],

        designTemplate: function () {
            return '<video class="{{me.class}}" width="{{me.width}}" height="{{me.height}}" controls/>';
        },

        runtimeTemplate: function (props) {
            var tmpl = '<div ng-show="app.fn.isTrue(me.visible)" class="ng-hide ' + props.class + '">' 
                        + '<video ng-attr-src="{{me.videosrc}}" ng-attr-width="{{me.width}}" ng-attr-height="{{me.height}}" '
                        + (props.showcontrols.toString() == 'true' ? 'controls ' : '')
                        + 'preload="{{me.preload}}" '
                        + 'twx-service-handler '
                        + 'onPlay="twx.app.fn.triggerStudioEvent(event.target, \'playStarted\', \'me.isPlaying=true\')" '
                        + 'onPause="twx.app.fn.triggerStudioEvent(event.target, \'playPaused\', \'me.isPlaying=false\')" '
                        + 'onEnded="twx.app.fn.triggerStudioEvent(event.target, \'playEnded\', \'me.isPlaying=false\')"'
                        + '></video></div>';
            return tmpl;
        }
    }
}

twxAppBuilder.widget('twxVideo', twxVideo);