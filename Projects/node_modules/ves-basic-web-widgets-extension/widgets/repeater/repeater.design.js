/* begin copyright text
 *
 * Copyright Â© 2016 PTC Inc., Its Subsidiary Companies, and /or its Partners. All Rights Reserved.
 *
 * end copyright text
 */
(function (twxAppBuilder) {

  function twxRepeater() {
    return {
      elementTag: 'twx-repeater',

      label: 'ves-basic-web-widgets-extension:Repeater',

      category: 'basic-html',

      isRepeater: true,

      properties: [
        {
            name: 'class',
            label: 'ves-basic-web-widgets-extension:Class',
            datatype: 'string',
            //default: '',
            isBindingTarget: true
        },
        {
          name: 'data',
          label: 'ves-basic-web-widgets-extension:Data',
          datatype: 'infotable',
          isBindingTarget: true
        },
        {
          name: 'repeatercontentwidth',
          label: 'ves-basic-web-widgets-extension:Repeater Cell Width (in px or %)',
          datatype: 'string',
          default: '100%'
        },
        {
          name: 'repeatercontentheight',
          label: 'ves-basic-web-widgets-extension:Repeater Cell Height (in px or %)',
          datatype: 'string',
          default: 'auto'
        },
        {
          name: 'repeatercontentpadding',
          label: 'ves-basic-web-widgets-extension:Repeater Cell Padding (in px or %)',
          datatype: 'string',
          default: '0'
        },
        {
          name: 'repeatercontentmargin',
          label: 'ves-basic-web-widgets-extension:Repeater Cell Margin (in px or %)',
          datatype: 'string',
          default: '0'
        },
        {
          name: 'width',
          label: 'ves-basic-web-widgets-extension:Width',
          datatype: 'string',
          default: '100%'
        },
        {
          name: 'selection',
          label: 'ves-basic-web-widgets-extension:Selection',
          datatype: 'boolean',
          default: false
        },
        {
          name: 'multiselect',
          label: 'ves-basic-web-widgets-extension:Multi-Select',
          datatype: 'boolean',
          default: false,
          isVisible: function(props){
            return (props.selection === true);
          }
        },
        {
          name: 'visible',
          label: 'ves-basic-web-widgets-extension:Visible',
          datatype: 'boolean',
          default: true,
          isBindingTarget: true
        },
        {
          name: 'scrollable',
          label: 'ves-basic-web-widgets-extension:Scrollable',
          datatype: 'boolean',
          default: true,
          isVisible: false
        },
        {
          name: 'direction',
          label: 'ves-basic-web-widgets-extension:Flex Direction',
          datatype: 'string',
          default: 'column',
          editor: 'select',
          options: [
            { label: 'ves-basic-web-widgets-extension:Top Down', value: 'column' },
            { label: 'ves-basic-web-widgets-extension:Left to Right', value: 'row' },
            { label: 'ves-basic-web-widgets-extension:Bottom Up', value: 'column-reverse' },
            { label: 'ves-basic-web-widgets-extension:Right to Left', value: 'row-reverse' }
          ]
        },
        {
          name: 'justification',
          label: 'ves-basic-web-widgets-extension:Justification',
          datatype: 'string',
          default: 'flex-start',
          editor: 'select',
          options: [
            { label: 'ves-basic-web-widgets-extension:Stack to Left', value: 'flex-start' },
            { label: 'ves-basic-web-widgets-extension:Stack to Right', value: 'flex-end' },
            { label: 'ves-basic-web-widgets-extension:Center', value: 'center' },
            { label: 'ves-basic-web-widgets-extension:Even Space Between', value: 'space-between' },
            { label: 'ves-basic-web-widgets-extension:Even Space Around', value: 'space-around' }
          ]
        },
        {
          name: 'alignment',
          label: 'ves-basic-web-widgets-extension:Alignment',
          datatype: 'string',
          default: 'stretch',
          editor: 'select',
          options: [
            { label: 'ves-basic-web-widgets-extension:Start', value: 'flex-start' },
            { label: 'ves-basic-web-widgets-extension:End', value: 'flex-end' },
            { label: 'ves-basic-web-widgets-extension:Center', value: 'center' },
            { label: 'ves-basic-web-widgets-extension:Stretch', value: 'stretch' },
            { label: 'ves-basic-web-widgets-extension:Baseline', value: 'baseline' }
          ]
        },
        {
          name: 'wrap',
          label: 'Content Wrap',
          datatype: 'string',
          default: 'nowrap',
          editor: 'select',
          options: [
            { label: 'ves-basic-web-widgets-extension:Wrap', value: 'wrap' },
            { label: 'ves-basic-web-widgets-extension:No Wrap', value: 'nowrap' }
          ]
        }
      ],

      events: [
        {
          name: 'itemclick',
          label: 'ves-basic-web-widgets-extension:ItemClick'
        }
      ],

      designTemplate: function () {
        return '<div style="flex-wrap: {{me.wrap}}; -webkit-flex-wrap: {{me.wrap}}; width: {{me.width}};"><div class="repeater-cell" style="height: {{me.repeatercontentheight}}; display: flex; justify-content: {{me.justification}}; width: {{me.repeatercontentwidth}}; padding: {{me.repeatercontentpadding}}; margin: {{me.repeatercontentmargin}};"><twx-repeater-content style="display: flex; flex-direction: {{me.direction}}; justify-content: {{me.justification}}; -webkit-justify-content: {{me.justification}}; align-self: {{me.alignment}}; width: {{me.repeatercontentwidth}};"></twx-repeater-content></div></div>';
      },

      runtimeTemplate: function (properties) {
        var selection = '';
        if(properties.selection === 'true'){
          selection = 'selection';
        }
        var scrollableClass = (properties.scrollable === 'true') ? 'scrollable' : '';
        var tmpl = '<div ng-show="app.fn.isTrue(me.visible)" class="ng-hide repeater {{me.class}} '+ selection +' '+ scrollableClass +'" style="flex-wrap: {{me.wrap}}; -webkit-flex-wrap: {{me.wrap}}; width: {{me.width}};">' +
                      '<div class="repeater-cell ng-class:{\'selected\': app.fn.isItemSelected(item)}" ng-click="app.fn.clickItemInRepeater(item,me.data,me.multiselect);fireEvent(\'itemclick\', item,me.data,me.multiselect); "' +
                        'style="height: {{me.repeatercontentheight}}; display: flex; justify-content: {{me.justification}};' + 
                        'width: {{me.repeatercontentwidth}}; ' + 
                        'padding: {{me.repeatercontentpadding}}; ' +
                        'margin: {{me.repeatercontentmargin}};" ' + 
                        'ng-repeat="item in me.data">' +
                          '<twx-repeater-content style="display: flex; flex-direction: {{me.direction}}; justify-content: {{me.justification}}; -webkit-justify-content: {{me.justification}}; align-self: {{me.alignment}}; width: {{me.repeatercontentwidth}};"></twx-repeater-content>' + 
                      '</div>' +
                    '</div>';
        return tmpl;
      }
    }
  }

  twxAppBuilder.widget('twxRepeater', twxRepeater);

})(twxAppBuilder);